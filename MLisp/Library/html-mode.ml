(defun
    (HTML-mode
	(setq mode-string "HTML")
	(use-syntax-table "HTML")
	(use-local-map "HTML-map")
	(use-abbrev-table "HTML")
	(novalue)
    )
)

(defun
    (HTML-view-buffer
	(if buffer-is-modified
	    (write-current-file)
	)
	(WIN-HTML-command current-buffer-file-name)
    )
)

(defun
    (~mode-modify-syntax-table
	~type
	~arg
	(setq ~type (arg 1))
	(setq ~arg 2)
	(while (<= ~arg (nargs))
	    (modify-syntax-table ~type (arg ~arg))
	    (setq ~arg (+ ~arg 1))
	)
    )
)
(defun
    ~HTML-setup()
    (save-window-excursion
	(temp-use-buffer "~mode-hack")    
	(use-syntax-table "HTML")
	(modify-syntax-table "word" "-_")
	
	(modify-syntax-table "comment" ">" "<")
	(modify-syntax-table "string" "\"")	
	(~mode-modify-syntax-table "keyword-1,case-fold"
	    "a"
	    "address"
	    "applet"
	    "area"
	    "b"
	    "base"
	    "basefont"
	    "bgsound"
	    "big"
	    "blink"
	    "blockquote"
	    "body"
	    "br"
	    "button"
	    "caption"
	    "center"
	    "cite"
	    "code"
	    "col"
	    "colgroup"
	    "comment"
	    "dd"
	    "dfn"
	    "dir"
	    "div"
	    "dl"
	    "dt"
	    "em"
	    "embed"
	    "font"
	    "form"
	    "frame"
	    "frameset"
	    "h1"
	    "h2"
	    "h3"
	    "h4"
	    "h5"
	    "h6"
	    "head"
	    "hr"
	    "html"
	    "i"
	    "iframe"
	    "ilayer"
	    "img"
	    "input"
	    "isindex"
	    "kbd"
	    "layer"
	    "li"
	    "link"
	    "listing"
	    "map"
	    "marquee"
	    "menu"
	    "meta"
	    "multicol"
	    "nextid"
	    "nobr"
	    "noembed"
	    "noframes"
	    "noscript"
	    "object"
	    "ol"
	    "option"
	    "p"
	    "param"
	    "plaintext"
	    "pre"
	    "s"
	    "samp"
	    "script"
	    "select"
	    "server"
	    "small"
	    "spacer"
	    "span"
	    "strike"
	    "strong"
	    "style"
	    "sub"
	    "sup"
	    "table"
	    "tbody"
	    "td"
	    "textarea"
	    "tfoot"
	    "th"
	    "thead"
	    "title"
	    "tr"
	    "tt"
	    "u"
	    "ul"
	    "var"
	    "wbr"
	    "xmp"
	)
	(~mode-modify-syntax-table "keyword-2,case-fold"
	    "checked"
	    "compact"
	    "controls"
	    "declare"
	    "hidden"
	    "mayscript"
	    "multiple"
	    "nohref"
	    "noresize"
	    "noshade"
	    "notab"
	    "notab"
	    "nowrap"
	    "selected"
	    "shapes"
	    "above="
	    "action="
	    "align="
	    "alink="
	    "alt="
	    "archive="
	    "background="
	    "behavious="
	    "below="
	    "bgcolor="
	    "bgproperties="
	    "border="
	    "bordercolor="
	    "bordercolordark="
	    "bordercolorlight="
	    "cellpadding="
	    "cellspacing="
	    "charset="
	    "class="
	    "classid="
	    "clear="
	    "clip="
	    "code="
	    "codebase="
	    "codetype="
	    "col="
	    "color="
	    "cols="
	    "colspan="
	    "content="
	    "coords="
	    "data="
	    "direction="
	    "dynsrc="
	    "enctype="
	    "face="
	    "frame="
	    "frameborder="
	    "framespacing="
	    "gutter="
	    "height="
	    "href="
	    "href="
	    "hspace="
	    "http-equiv="
	    "id="
	    "ismap="
	    "lang="
	    "language="
	    "left="
	    "leftmargin="
	    "link="
	    "loop="
	    "lowsrc="
	    "marginheight="
	    "marginwidth="
	    "maxlength="
	    "method="
	    "n="
	    "name="
	    "onabort="
	    "onblur="
	    "onchange="
	    "onclick="
	    "onerror="
	    "onfocus="
	    "onload="
	    "onload="
	    "onmouseout="
	    "onmouseover="
	    "onreset="
	    "onselect="
	    "onsubmit="
	    "onunload="
	    "palette="
	    "pluginspage="
	    "prompt="
	    "rel="
	    "rev="
	    "rows="
	    "rowspan="
	    "rules="
	    "scrollamount="
	    "scrolldelay="
	    "scrolling="
	    "shape="
	    "size="
	    "span="
	    "src="
	    "standby="
	    "start="
	    "style="
	    "tabindex="
	    "taborder="
	    "target="
	    "text="
	    "title="
	    "top="
	    "topmargin="
	    "type="
	    "type="
	    "type="
	    "units="
	    "usemap="
	    "usemap="
	    "valign="
	    "value="
	    "valuetype="
	    "version="
	    "visility="
	    "vlink="
	    "vspace="
	    "vspace="
	    "width="
	    "wrap="
	    "z-index="
	    
	)
	
	(define-keymap "HTML-map")
	(use-local-map "HTML-map")
	
	(local-bind-to-key "HTML-view-buffer" "\ec")
	
	(kill-buffer "~mode-hack")
	(novalue)
    )
)
(~HTML-setup)
