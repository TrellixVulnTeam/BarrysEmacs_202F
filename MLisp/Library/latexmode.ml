(progn
    (if (! (is-bound latex-auto-expansion))
        (progn
	    (declare-buffer-specific latex-auto-expansion)
	    (setq-default latex-auto-expansion 1)
	)
    )
    (if (! (is-bound latex-spell-check))
        (progn
	    (declare-buffer-specific latex-spell-check)
	    (setq-default latex-spell-check 1)
	)
    )
    (defun ~LaTeX-auto-fill ()
	(if (!=
		(save-excursion
		    (beginning-of-line)
		    (forward-word)
		    (+ (dot))
		)
		(+ (dot))
	    )
	    (progn
		(backward-word)
		(delete-white-space)
	    )
	)
	(save-excursion (newline) (to-col left-margin))
	(error-occurred (if latex-spell-check (spell-line)))
	(next-line)
	(end-of-line)
    )
    (defun
	(latex-mode
	    (use-syntax-table "LaTeX-mode")
	    (use-abbrev-table "LaTeX-mode")
	    (setq auto-fill-hook "~LaTeX-auto-fill")
	    (setq abbrev-mode latex-auto-expansion)
	    (use-local-map "LaTeX-MAP")
	    (setq mode-string "LaTeX")
	    (setq right-margin 76)
	    (setq left-margin 1)
	    (novalue)
	)
	(~LaTeX-environment-name
	    (setq ~LaTeX-envir "")
	    (language-fetch-mandatory "Insert the environemnt name and use exit-emacs.")
	    (save-window-excursion
		(goto-character template-start-field)
		(set-mark)
		(goto-character template-end-field)(backward-character)
		(setq ~LaTeX-envir (region-to-string))
	    )
	    (goto-character template-end-field)
	)
	(~LaTeX-%
	    language-start-entity
	    language-exit-point
	    (language-template-driver "LaTeX" "%" 0)
	)
	(~LaTeX-abbrev-handler
	    LaTeX-ah-current
	    ~LaTeX-envir
	    (setq LaTeX-ah-current (current-syntax-entity))
	    (if (&
		    (|
			(= LaTeX-ah-current is-word)
			(= LaTeX-ah-current is-dull)
		    )
		    (> (length abbrev-expansion) 0)
		)
		(progn
		    LaTeX-ah-case-fold-search
		    LaTeX-ah-looking-at
		    LaTeX-ah-data
		    language-start-entity
		    LaTeX-last-key-struck
		    language-exit-point
		    (setq LaTeX-ah-case-fold-search case-fold-search)
		    (setq case-fold-search 0)
		    (setq LaTeX-ah-looking-at
			(provide-prefix-argument -1
			    (looking-at (quote abbrev-expansion))
			)
		    )
		    (setq case-fold-search LaTeX-ah-case-fold-search)
		    (if LaTeX-ah-looking-at
			(progn
			    (save-window-excursion
				(region-around-match 0)
				(erase-region)
			    )
			    (setq LaTeX-last-key-struck (last-key-struck))
			    (language-template-driver "LaTeX" abbrev-expansion 1)
			)
		    )
		)
	    )
	    (novalue)
	)
	(~LaTeX-obrack
	    language-start-entity
	    language-exit-point
	    LaTeX-last-key-struck
	    (setq LaTeX-last-key-struck '\r')
	    (if (!= (preceding-char) 92)
		(if (= (current-syntax-entity) is-dull)
		    (language-template-driver "LaTeX" (char-to-string (last-key-struck)) 0)
		    (insert-character (last-key-struck))
		)
		(insert-character (last-key-struck))
	    )
	)
	(~LaTeX-brackets
	    language-start-entity
	    language-exit-point
	    LaTeX-last-key-struck
	    (setq LaTeX-last-key-struck '\r')
	    (if (= (preceding-char) 92)
		(if (= (current-syntax-entity) is-dull)
		    (language-template-driver "LaTeX" (char-to-string (last-key-struck)) 0)
		    (insert-character (last-key-struck))
		)
		(insert-character (last-key-struck))
	    )
	)
	(~LaTeX-insert-optional
	    (if (= (dot) language-start-entity) (insert-string (arg 1)))
	)
	(expand-LaTeX-keyword
	    ~LaTeX-envir
	    LaTeX-ek-case-fold-search
	    LaTeX-ek-looking-at
	    LaTeX-ek-data
	    language-start-entity
	    LaTeX-last-key-struck
	    language-exit-point
	    (setq LaTeX-ek-case-fold-search case-fold-search)
	    (setq case-fold-search 1)
	    (setq LaTeX-last-key-struck '\r')
	    (setq LaTeX-ek-looking-at
		(provide-prefix-argument -1
		    (looking-at "\\w")
		)
	    )
	    (setq case-fold-search LaTeX-ek-case-fold-search)
	    (if LaTeX-ek-looking-at
		(progn
		    (save-window-excursion
			(backward-word)
			(set-mark)
			(forward-word)
			(case-region-lower)
			(setq LaTeX-ek-data (region-to-string))
			(erase-region)
		    )
		    (language-template-driver "LaTeX" LaTeX-ek-data 0)
		)
	    )
	    (novalue)
	)
    )
    (save-window-excursion
	(if (! (is-bound language-loaded))
	    (execute-mlisp-file "language_support")
	)
	(if (! (is-bound paren-flash))
	    (execute-mlisp-file "flasher")
	)
	(switch-to-buffer "LaTeX-mode")
	(define-keymap "LaTeX-MAP")
	(use-local-map "LaTeX-MAP")
	(use-abbrev-table "LaTeX-mode")
	(use-syntax-table "LaTeX-mode")
	(modify-syntax-table "word" "\\*")
	(modify-syntax-table "paren" "(" ")")
	(modify-syntax-table "paren" "[" "]")
	(modify-syntax-table "paren" "{" "}")
	(modify-syntax-table "comment" "%" "\n")
	(local-bind-to-key "~LaTeX-%" "%")
	(local-bind-to-key "~LaTeX-obrack" "$")
	(local-bind-to-key "~LaTeX-obrack" "{")
	(local-bind-to-key "~LaTeX-brackets" "(")
	(local-bind-to-key "~LaTeX-brackets" "[")
	(local-bind-to-key "paren-flash" ")")
	(local-bind-to-key "paren-flash" "]")
	(local-bind-to-key "paren-flash" "}")
	(if latex-spell-check
	    (local-bind-to-key "spell-newline" "\r")
	)
	(error-occurred (execute-mlisp-file "latexmode.key"))
	(define-hooked-local-abbrev "\\begin" "\\begin" "~LaTeX-abbrev-handler")
	(define-hooked-local-abbrev "\\item" "\\item" "~LaTeX-abbrev-handler")
	(define-hooked-local-abbrev "\\tag" "\\tag" "~LaTeX-abbrev-handler")
	(define-hooked-local-abbrev "\\mbox" "\\mbox" "~LaTeX-abbrev-handler")
	(define-hooked-local-abbrev "\\footnote" "\\footnote" "~LaTeX-abbrev-handler")
	(define-hooked-local-abbrev "\\footnotemark" "\\footnotemark" "~LaTeX-abbrev-handler")
	(define-hooked-local-abbrev "\\footnotetext" "\\footnotetext" "~LaTeX-abbrev-handler")
	(define-hooked-local-abbrev "\\part" "\\part" "~LaTeX-abbrev-handler")
	(define-hooked-local-abbrev "\\chapter" "\\chapter" "~LaTeX-abbrev-handler")
	(define-hooked-local-abbrev "\\section" "\\section" "~LaTeX-abbrev-handler")
	(define-hooked-local-abbrev "\\subsection" "\\subsection" "~LaTeX-abbrev-handler")
	(define-hooked-local-abbrev "\\subsubsection" "\\subsubsection" "~LaTeX-abbrev-handler")
	(define-hooked-local-abbrev "\\paragraph" "\\paragraph" "~LaTeX-abbrev-handler")
	(define-hooked-local-abbrev "\\subparagraph" "\\subparagraph" "~LaTeX-abbrev-handler")
	(define-hooked-local-abbrev "\\part*" "\\part*" "~LaTeX-abbrev-handler")
	(define-hooked-local-abbrev "\\chapter*" "\\chapter*" "~LaTeX-abbrev-handler")
	(define-hooked-local-abbrev "\\section*" "\\section*" "~LaTeX-abbrev-handler")
	(define-hooked-local-abbrev "\\subsection*" "\\subsection*" "~LaTeX-abbrev-handler")
	(define-hooked-local-abbrev "\\subsubsection*" "\\subsubsection*" "~LaTeX-abbrev-handler")
	(define-hooked-local-abbrev "\\paragraph*" "\\paragraph*" "~LaTeX-abbrev-handler")
	(define-hooked-local-abbrev "\\subparagraph*" "\\subparagraph*" "~LaTeX-abbrev-handler")
	(define-hooked-local-abbrev "\\addcontentsline" "\\addcontentsline" "~LaTeX-abbrev-handler")
	(define-hooked-local-abbrev "\\addtocontents" "\\addtocontents" "~LaTeX-abbrev-handler")
	(define-hooked-local-abbrev "\\documentstyle" "\\documentstyle" "~LaTeX-abbrev-handler")
	(define-hooked-local-abbrev "\\pagestyle" "\\pagestyle" "~LaTeX-abbrev-handler")
	(define-hooked-local-abbrev "\\markright" "\\markright" "~LaTeX-abbrev-handler")
	(define-hooked-local-abbrev "\\markboth" "\\markboth" "~LaTeX-abbrev-handler")
	(define-hooked-local-abbrev "\\twocolumn" "\\twocolumn" "~LaTeX-abbrev-handler")
	(define-hooked-local-abbrev "\\pagenumbering" "\\pagenumbering" "~LaTeX-abbrev-handler")
	(define-hooked-local-abbrev "\\title" "\\title" "~LaTeX-abbrev-handler")
	(define-hooked-local-abbrev "\\author" "\\author" "~LaTeX-abbrev-handler")
	(define-hooked-local-abbrev "\\date" "\\date" "~LaTeX-abbrev-handler")
	(define-hooked-local-abbrev "\\thanks" "\\thanks" "~LaTeX-abbrev-handler")
	(define-hooked-local-abbrev "\\makelabel" "\\makelabel" "~LaTeX-abbrev-handler")
	(define-hooked-local-abbrev "\\usecounter" "\\usecounter" "~LaTeX-abbrev-handler")
	(define-hooked-local-abbrev "\\lefteqn" "\\lefteqn" "~LaTeX-abbrev-handler")
	(define-hooked-local-abbrev "\\frac" "\\frac" "~LaTeX-abbrev-handler")
	(define-hooked-local-abbrev "\\sqrt" "\\sqrt" "~LaTeX-abbrev-handler")
	(define-hooked-local-abbrev "\\pmod" "\\pmod" "~LaTeX-abbrev-handler")
	(define-hooked-local-abbrev "\\overline" "\\overline" "~LaTeX-abbrev-handler")
	(define-hooked-local-abbrev "\\underline" "\\underline" "~LaTeX-abbrev-handler")
	(define-hooked-local-abbrev "\\stackrel" "\\stackrel" "~LaTeX-abbrev-handler")
	(define-hooked-local-abbrev "\\newcommand" "\\newcommand" "~LaTeX-abbrev-handler")
	(define-hooked-local-abbrev "\\renewcommand" "\\renewcommand" "~LaTeX-abbrev-handler")
	(define-hooked-local-abbrev "\\newenvironment" "\\newenvironment" "~LaTeX-abbrev-handler")
	(define-hooked-local-abbrev "\\renewenvironment" "\\renewenvironment" "~LaTeX-abbrev-handler")
	(define-hooked-local-abbrev "\\newtheorem" "\\newtheorem" "~LaTeX-abbrev-handler")
	(define-hooked-local-abbrev "\\newcounter" "\\newcounter" "~LaTeX-abbrev-handler")
	(define-hooked-local-abbrev "\\setcounter" "\\setcounter" "~LaTeX-abbrev-handler")
	(define-hooked-local-abbrev "\\addtocounter" "\\addtocounter" "~LaTeX-abbrev-handler")
	(define-hooked-local-abbrev "\\value" "\\value" "~LaTeX-abbrev-handler")
	(define-hooked-local-abbrev "\\caption" "\\caption" "~LaTeX-abbrev-handler")
	(define-hooked-local-abbrev "\\arabic" "\\arabic" "~LaTeX-abbrev-handler")
	(define-hooked-local-abbrev "\\roman" "\\roman" "~LaTeX-abbrev-handler")
	(define-hooked-local-abbrev "\\alpha" "\\alpha" "~LaTeX-abbrev-handler")
	(define-hooked-local-abbrev "\\fnsymbol" "\\fnsymbol" "~LaTeX-abbrev-handler")
	(define-hooked-local-abbrev "\\marginpar" "\\marginpar" "~LaTeX-abbrev-handler")
	(define-hooked-local-abbrev "\\multicolumn" "\\multicolumn" "~LaTeX-abbrev-handler")
	(define-hooked-local-abbrev "\\cline" "\\cline" "~LaTeX-abbrev-handler")
	(define-hooked-local-abbrev "\\label" "\\label" "~LaTeX-abbrev-handler")
	(define-hooked-local-abbrev "\\ref" "\\ref" "~LaTeX-abbrev-handler")
	(define-hooked-local-abbrev "\\pageref" "\\pageref" "~LaTeX-abbrev-handler")
	(define-hooked-local-abbrev "\\index" "\\index" "~LaTeX-abbrev-handler")
	(define-hooked-local-abbrev "\\glossary" "\\glossary" "~LaTeX-abbrev-handler")
	(define-hooked-local-abbrev "\\linebreak" "\\linebreak" "~LaTeX-abbrev-handler")
	(define-hooked-local-abbrev "\\nolinebreak" "\\nolinebreak" "~LaTeX-abbrev-handler")
	(define-hooked-local-abbrev "\\pagebreak" "\\pagebreak" "~LaTeX-abbrev-handler")
	(define-hooked-local-abbrev "\\nopagebreak" "\\nopagebreak" "~LaTeX-abbrev-handler")
	(define-hooked-local-abbrev "\\setlength" "\\setlength" "~LaTeX-abbrev-handler")
	(define-hooked-local-abbrev "\\addtolength" "\\addtolength" "~LaTeX-abbrev-handler")
	(define-hooked-local-abbrev "\\vspace" "\\vspace" "~LaTeX-abbrev-handler")
	(define-hooked-local-abbrev "\\vspace*" "\\vspace*" "~LaTeX-abbrev-handler")
	(define-hooked-local-abbrev "\\makebox" "\\makebox" "~LaTeX-abbrev-handler")
	(define-hooked-local-abbrev "\\framebox" "\\framebox" "~LaTeX-abbrev-handler")
	(define-hooked-local-abbrev "\\usebox" "\\usebox" "~LaTeX-abbrev-handler")
	(define-hooked-local-abbrev "\\rule" "\\rule" "~LaTeX-abbrev-handler")
	(define-hooked-local-abbrev "\\put" "\\put" "~LaTeX-abbrev-handler")
	(define-hooked-local-abbrev "\\line" "\\line" "~LaTeX-abbrev-handler")
	(define-hooked-local-abbrev "\\bibliography" "\\bibliography" "~LaTeX-abbrev-handler")
	(define-hooked-local-abbrev "\\bibitem" "\\bibitem" "~LaTeX-abbrev-handler")
	(define-hooked-local-abbrev "\\cite" "\\cite" "~LaTeX-abbrev-handler")
	(define-hooked-local-abbrev "\\nocite" "\\nocite" "~LaTeX-abbrev-handler")
	(define-hooked-local-abbrev "\\include" "\\include" "~LaTeX-abbrev-handler")
	(define-hooked-local-abbrev "\\input" "\\input" "~LaTeX-abbrev-handler")
	(define-hooked-local-abbrev "\\includeonly" "\\includeonly" "~LaTeX-abbrev-handler")
	(define-hooked-local-abbrev "\\typeout" "\\typeout" "~LaTeX-abbrev-handler")
	(define-hooked-local-abbrev "\\typein" "\\typein" "~LaTeX-abbrev-handler")
	(define-hooked-local-abbrev "\\hyphenation" "\\hyphenation" "~LaTeX-abbrev-handler")
	(define-hooked-local-abbrev "\\newlength" "\\newlength" "~LaTeX-abbrev-handler")
	(define-hooked-local-abbrev "\\stretch" "\\stretch" "~LaTeX-abbrev-handler")
	(define-hooked-local-abbrev "\\settowidth" "\\settowidth" "~LaTeX-abbrev-handler")
	(define-hooked-local-abbrev "\\hspace" "\\hspace" "~LaTeX-abbrev-handler")
	(define-hooked-local-abbrev "\\hspace*" "\\hspace*" "~LaTeX-abbrev-handler")
	(define-hooked-local-abbrev "\\addvspace" "\\addvspace" "~LaTeX-abbrev-handler")
	(define-hooked-local-abbrev "\\fbox" "\\fbox" "~LaTeX-abbrev-handler")
	(define-hooked-local-abbrev "\\savebox" "\\savebox" "~LaTeX-abbrev-handler")
	(define-hooked-local-abbrev "\\parbox" "\\parbox" "~LaTeX-abbrev-handler")
	(define-hooked-local-abbrev "\\raisebox" "\\raisebox" "~LaTeX-abbrev-handler")
	(define-hooked-local-abbrev "\\multiput" "\\multiput" "~LaTeX-abbrev-handler")
	(define-hooked-local-abbrev "\\vector" "\\vector" "~LaTeX-abbrev-handler")
	(define-hooked-local-abbrev "\\shortstack" "\\shortstack" "~LaTeX-abbrev-handler")
	(define-hooked-local-abbrev "\\circle" "\\circle" "~LaTeX-abbrev-handler")
	(define-hooked-local-abbrev "\\circle*" "\\circle*" "~LaTeX-abbrev-handler")
	(define-hooked-local-abbrev "\\oval" "\\oval" "~LaTeX-abbrev-handler")
	(define-hooked-local-abbrev "\\frame" "\\frame" "~LaTeX-abbrev-handler")
	(define-hooked-local-abbrev "\\load" "\\load" "~LaTeX-abbrev-handler")
	(define-hooked-local-abbrev "\\newfont" "\\newfont" "~LaTeX-abbrev-handler")
	(define-hooked-local-abbrev "\\symbol" "\\symbol" "~LaTeX-abbrev-handler")
    )
    (delete-buffer "LaTeX-mode")
    (novalue)
)
